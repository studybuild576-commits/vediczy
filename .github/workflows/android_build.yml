name: Android Build and SHA1 Key
on:
Â Â push:
Â Â Â Â branches:
Â Â Â Â Â Â - main
Â Â workflow_dispatch:
jobs:
Â Â build:
Â Â Â Â runs-on: ubuntu-latest
Â Â Â Â steps:
Â Â Â Â - name: Checkout repository
Â Â Â Â Â Â uses: actions/checkout@v4
Â Â Â Â - name: Set up JDK
Â Â Â Â Â Â uses: actions/setup-java@v4
Â Â Â Â Â Â with:
Â Â Â Â Â Â Â Â java-version: '17'
Â Â Â Â Â Â Â Â distribution: 'temurin'
Â Â Â Â - name: Decode permanent keystore
Â Â Â Â Â Â run: |
Â Â Â Â Â Â Â Â echo "${{ secrets.CM_KEYSTORE }}" | base64 --decode > android/app/upload-keystore.jks
Â Â Â Â - name: Create key.properties file
Â Â Â Â Â Â run: |
Â Â Â Â Â Â Â Â echo "storeFile=upload-keystore.jks" > android/key.properties
Â Â Â Â Â Â Â Â echo "storePassword=${{ secrets.CM_KEYSTORE_PASSWORD }}" >> android/key.properties
Â Â Â Â Â Â Â Â echo "keyAlias=${{ secrets.CM_KEY_ALIAS }}" >> android/key.properties
Â Â Â Â Â Â Â Â echo "keyPassword=${{ secrets.CM_KEY_PASSWORD }}" >> android/key.properties
Â Â Â Â - name: Generate SHA1 from permanent keystore
Â Â Â Â Â Â run: |
Â Â Â Â Â Â Â Â echo "ğŸ” Permanent SHA1 (from keystore):"
Â Â Â Â Â Â Â Â keytool -list -v \
Â Â Â Â Â Â Â Â Â Â -keystore android/app/upload-keystore.jks \
Â Â Â Â Â Â Â Â Â Â -alias "${{ secrets.CM_KEY_ALIAS }}" \
Â Â Â Â Â Â Â Â Â Â -storepass "${{ secrets.CM_KEYSTORE_PASSWORD }}" \
Â Â Â Â Â Â Â Â Â Â -keypass "${{ secrets.CM_KEY_PASSWORD }}" \
Â Â Â Â Â Â Â Â Â Â | grep 'SHA1:'
Â Â Â Â - name: Show expected SHA1 (from secret)
Â Â Â Â Â Â run: |
Â Â Â Â Â Â Â Â echo "âœ… Expected SHA1 (from GitHub Secret):"
Â Â Â Â Â Â Â Â echo "${{ secrets.PERMANENT_SHA1 }}"
Â Â Â Â - name: Set up Flutter
Â Â Â Â Â Â uses: subosito/flutter-action@v2
Â Â Â Â Â Â with:
Â Â Â Â Â Â Â Â flutter-version: '3.35.2'Â Â Â # <-- Latest stable Flutter with Dart 3.9+
Â Â Â Â - name: Install Flutter dependencies
Â Â Â Â Â Â run: flutter pub get
Â Â Â Â - name: Build signed release APK
Â Â Â Â Â Â run: flutter build apk --release
Â Â Â Â - name: Upload release APK
Â Â Â Â Â Â uses: actions/upload-artifact@v4
Â Â Â Â Â Â with:
Â Â Â Â Â Â Â Â name: release-apk
Â Â Â Â Â Â Â Â path: build/app/outputs/flutter-apk/app-release.apk
